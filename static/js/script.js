document.addEventListener('DOMContentLoaded', function() {
    // 1. рдЖрд╡рд╢реНрдпрдХ рддрддреНрд╡реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
    const stockForm = document.getElementById('stockForm');
    const stockSelect = document.getElementById('stock_select');
    const inputFormContainer = document.getElementById('inputFormContainer');
    const predictionFormHeading = inputFormContainer.querySelector('h2');
    const hiddenStockName = document.getElementById('hidden_stock_name');

    // 2. рд╕реНрдЯреЙрдХ рдЪрдпрди рдлрд╝реЙрд░реНрдо рд╕рдмрдорд┐рдЯ рд╣реЛрдиреЗ рдкрд░ рд╣реИрдВрдбрд▓ рдХрд░реЗрдВ
    stockForm.addEventListener('submit', function(event) {
        // рдлрд╝реЙрд░реНрдо рд╕рдмрдорд┐рд╢рди рдХреЛ рд░реЛрдХреЗрдВ рддрд╛рдХрд┐ рдкреЗрдЬ рд░реАрд▓реЛрдб рди рд╣реЛ
        event.preventDefault();

        // рдЪреБрдиреЗ рд╣реБрдП рд╕реНрдЯреЙрдХ рдХрд╛ рдорд╛рди (рдЬреИрд╕реЗ: "reliance")
        const selectedStockValue = stockSelect.value;
        // рдЪреБрдиреЗ рд╣реБрдП рд╕реНрдЯреЙрдХ рдХрд╛ рдЯреЗрдХреНрд╕реНрдЯ (рдЬреИрд╕реЗ: "RELIANCE")
        const selectedStockText = stockSelect.options[stockSelect.selectedIndex].text;

        // рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рд╕реНрдЯреЙрдХ рдЪреБрдирд╛ рдЧрдпрд╛ рд╣реИ (рд╡реИрд▓реНрдпреВ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП)
        if (selectedStockValue) {
            // A. 'inputFormContainer' рдХреЛ рджрд┐рдЦрд╛рдПрдВ
            inputFormContainer.style.display = 'block';

            // B. рд╣реЗрдбрд┐рдВрдЧ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
            predictionFormHeading.innerHTML = `ЁЯУИ **${selectedStockText}** рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ`;

            // C. рд╣рд┐рдбрди рдлрд╝реАрд▓реНрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ (рдпрд╣ Flask рдХреЛ рд╕реНрдЯреЙрдХ рдХрд╛ рдирд╛рдо рднреЗрдЬреЗрдЧрд╛)
            hiddenStockName.value = selectedStockValue;

            // D. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрдирдкреБрдЯ рдлрд╝реАрд▓реНрдб рдкрд░ рд▓реЗ рдЬрд╛рдПрдВ
            inputFormContainer.scrollIntoView({ behavior: 'smooth' });
        } else {
            // рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрд┐рдирд╛ рдЪрдпрди рдХрд┐рдП 'рдбреЗрдЯрд╛ рдПрдВрдЯрд░ рдХрд░реЗрдВ' рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддрд╛ рд╣реИ
            alert('рдХреГрдкрдпрд╛ рдкреНрд░реЗрдбрд┐рдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдЯреЙрдХ рдЪреБрдиреЗрдВред');
        }
    });

    // 3. рдпрджрд┐ рдХреЛрдИ рд╕реНрдЯреЙрдХ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд╝реЙрд░реНрдо рдХреЛ рдлрд┐рд░ рд╕реЗ рд╕рдмрдорд┐рдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдХреЗрд╡рд▓ рдЪрдпрди рдмрджрд▓рдиреЗ рдкрд░),
    // рддреЛ рдЗрдирдкреБрдЯ рдлрд╝реАрд▓реНрдб рдХреЛ рддреБрд░рдВрдд рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИрдВрдбрд▓рд░ред
    // рдпрд╣ 'submit' рд╣реИрдВрдбрд▓рд░ рдХреЗ рд╕рдорд╛рди рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди 'change' рдЗрд╡реЗрдВрдЯ рдкрд░ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИред
    stockSelect.addEventListener('change', function() {
        // 'change' рдЗрд╡реЗрдВрдЯ рдкрд░ рддреБрд░рдВрдд 'submit' рдЗрд╡реЗрдВрдЯ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрдорд┐рдЯ рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
        // (рдпрд╛ рдЖрдк рд╕реАрдзреЗ рдКрдкрд░ рджрд┐рдП рдЧрдП logic рдХреЛ рднреА рдпрд╣рд╛рдБ рджреЛрд╣рд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ)ред
        // рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рд╣реИ:
        stockForm.dispatchEvent(new Event('submit', { cancelable: true }));
    });
});